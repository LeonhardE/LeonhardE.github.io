---
layout: post
title: Oracle 第 14 周作业
categories: 数据库
description: 事务提交与一致性部分作业
keywords: 数据库，SYSU，Homework
---

1 有许多初学者会误以为 Oracle 会先把事务修改的数据放在内存缓冲区，如果“提交”则将其写入硬盘，如果“回滚”则作废，但实际上并非如此。做以下实验，创建一张很大的表(可以考虑利用笛卡尔积和批量插入)，做 delete 大部分行的操作，然后比较下此时进行提交或回滚的速度，说说你的看法。





2 在 ITPUB 网站上有积分转账功能，在输入框输入金额，然后选择目标用户，点击“转账“按钮，系统会首先用 select 语句检查转出者是否 有足够的余额，如果没有则报错，如果有，则通过 update 语句实现转账。后来有网友发现这样的 bug，他打开两个转账页面，同时给用户甲转账 10000 积分(他账户里有 12000 积分)，在系统比较繁忙(可以通过爬网页来让网站繁忙起来)响应较慢时，他用很快的速度同时点击这两个页面的转账按钮，结果都可以转账成功，用户甲有了 20000 积分，他自己变成-8000 积分，相当于可以从系统透支，请问这是什么原因?应该怎样解决?





3 验证 Oracle 使用的是自动“行”锁。打开 sqlplus 修改 emp 表中 King 的工资为 7000，但暂时不提交，再打开另外一个 sqlplus，试下修改 Jones 的工资为 3200，改 King 的 comm 为 1000，说明下结果的意 义。





4 试验隐式提交和自动提交





5 实验“死锁”，打开两个不同的 sqlplus 都用 scott 登录，形成会话 A 和会话 B，在 A 中需改 King 的工资为 8000，在 B 中修改 Jones 的工 资为 3120，然后，在 A 中修改 Jones 的工资为 3500，在 B 中修改 King 的工资为 9000，这会产生成为“死锁”的情况，A 在等 B 释放 Jones 行上的锁，B 在等 A 释放 King 行上的锁，彼此等待，就好像在窄马路上迎头狭路相逢的两辆车，看下 Oracle 是怎样解决死锁问题的?





6 学习 select ... for update 手工加锁的用法，例如把 10 部门涉及的 行手工加锁，然后再进行 select，update 等操作看下发生了什么影响。





7 关于读取一致性，这是一个比较繁琐的实验。首先构造一张很大的 表 A，对 A 进行一个时间比较长(因为 A 表很大)的查询 X，例如需 要 1 分钟才出结果，在查询 X 开始 10 秒以后修改表 A 的内容，请问这个修改会影响 X 的最终输出结果吗(即读取一致性问题)?你认为 比较合乎常理的逻辑应该是怎样的?验证一下 Oracle 是否实现读取 一致性的逻辑，你觉得它是通过什么方法实现的?





